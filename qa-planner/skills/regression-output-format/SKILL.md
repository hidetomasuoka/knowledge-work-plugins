---
name: regression-output-format
description: リグレッションテスト計画書の出力テンプレートと記述ルール。/create-regression コマンドから参照される。
---

# Regression Output Format

リグレッションテスト計画書のテンプレートと記述ルールを定義する。

## リグレッションテスト計画書テンプレート

```markdown
# リグレッションテスト計画書

**リリース：** {バージョン / リリース名}
**作成日：** {YYYY-MM-DD}
**作成者：** Claude

**対象 PR：**
| リポジトリ | PR | タイトル |
|-----------|-----|---------|
| {org/repo} | [#{番号}]({URL}) | {PR タイトル} |

---

## 1. リリース概要

{このリリースで何を変更するか、3〜5 行で要約}

## 2. 横断的変更分析

### 変更の全体像

| 変更タイプ | 対象 PR | 影響サービス |
|-----------|--------|------------|
| API 変更 | #{番号} | {サービス名} |
| DB 変更 | #{番号} | {サービス名} |

### サービス間波及リスク

| 変更元 | 変更内容 | 波及先 | リスク |
|-------|---------|-------|-------|
| {サービス名} | {変更概要} | {影響サービス} | 🔴高 / 🟡中 / 🟢低 |

### ユーザーフロー影響

| ユーザーフロー | 影響する PR | リスク |
|--------------|-----------|-------|
| {フロー名} | #{番号} | 🔴高 / 🟡中 |

## 3. テスト実施計画

### ✅ 必須テスト

| # | テスト項目 | 対象 PR | 前提条件 | 操作手順 | 期待結果 |
|---|-----------|--------|---------|---------|---------|
| 1 | {テスト項目名} | #{番号} | {前提} | {手順} | {期待結果} |

### 🔶 推奨テスト

| # | テスト項目 | 対象 PR | 前提条件 | 操作手順 | 期待結果 |
|---|-----------|--------|---------|---------|---------|
| 1 | {テスト項目名} | #{番号} | {前提} | {手順} | {期待結果} |

### ⬜ スキップ可

| 機能・画面 | スキップ理由 |
|-----------|------------|
| {機能名} | {影響なしと判断した根拠} |

## 4. デプロイ順序と確認ポイント

```
1. {リポジトリ名} — {デプロイ時の注意点}
2. {リポジトリ名} — {デプロイ時の注意点}
```

デプロイ後スモークテスト：
- [ ] {最低限確認すべき項目}

## 5. テストデータ

| # | データ種別 | 値・条件 | 用途 |
|---|----------|---------|-----|
| 1 | {データ種別} | {条件} | {用途} |

※ 本番データは使用しないこと。

## 6. 特記事項・リスク

- {リリース全体を通じた注意事項}
- {環境差異・ロールバック手順など}
- {未確認事項・レビュアーへの質問}
```

## 記述ルール

### 必須テストと推奨テストの判断基準

**✅ 必須テスト** — 以下のいずれかに該当：
- 変更された機能の正常系・異常系
- サービス間波及が確定している経路
- 過去インシデントと同パターンの変更
- ユーザーへの直接影響が大きいフロー（決済・認証・データ保存）

**🔶 推奨テスト** — 以下のいずれかに該当：
- 波及の可能性はあるが低リスクな既存機能
- 変更サービスを利用するが今回の変更とは別経路のフロー

**⬜ スキップ可** — 接点が証明できる場合のみ記載（理由必須）

### 横断分析の記述

- 複数 PR にまたがる同一機能の変更は1つのテスト項目に集約する
- サービス間波及は「変更元 → 変更内容 → 波及先」の順で明示する
- インフラ変更（Redis・MQ など）は影響サービスを `knowledge/service-dependency.md` から引用

### デプロイ順序

- 依存関係がある場合は必ず順序を明記
- スモークテストは最低1件記載（ユーザーが最初に触る機能を選ぶ）
- ロールバック基準（どの状態になったら戻すか）を特記事項に記載

### 複数リポジトリにまたがる場合

- 計画書はリポジトリごとに個別ファイルとして保存
- 共通のヘッダー（リリース概要・横断分析）は全ファイルに含める
- リポジトリ固有のテスト項目は各ファイルの「テスト実施計画」に記載
